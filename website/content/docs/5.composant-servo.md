---
title: "Servomoteur (SG90)"
description: "Contrôle de position avec servomoteurs standards dans l'expérience LOST."
category: "Composants"
---

# Servomoteur (SG90)

Le servomoteur permet un contrôle précis de l'angle mécanique (0° à 180°). Dans l'expérience **LOST**, il est utilisé pour ouvrir le "Rift Trap" à la fin du workshop.

![Servomoteur SG90](/components/servomotor/servomotor.jpg)

## Principe de Fonctionnement

Le servo est piloté par un signal **PWM** (Pulse Width Modulation) :
- Fréquence : **50 Hz** (période de 20ms)
- Largeur d'impulsion :
  - **0.5ms** → 0°
  - **1.5ms** → 90°
  - **2.5ms** → 180°

```
   0°        90°       180°
   ↓         ↓          ↓
   ┌─┐       ┌──┐       ┌───┐
───┘ └───────┘  └───────┘   └───
   0.5ms    1.5ms     2.5ms
   (5%)     (7.5%)    (12.5%)
```

## Câblage PWM

> [!WARNING]
> Ne pas alimenter le servo directement depuis l'ESP32. Utilisez une **alimentation 5V** pour éviter les resets et le jitter.

| Couleur Fil | Connexion | Note |
| :--- | :--- | :--- |
| **Rouge** | **Alim Externe (5V-6V)** | Source de puissance séparée (idéalement) |
| **Marron / Noir** | **GND** | Commun avec le GND de l'ESP32 |
| **Orange / Jaune** | **GPIO (PWM)** | Pin capable de PWM |

### Pinout dans l'Expérience LOST

| Rôle | GPIO | Nom Servo |
| :--- | :--- | :--- |
| **Dream** (Enfant) | **32** | DreamServo |
| **Nightmare** (Parent) | **2** | NightmareServo |

> [!TIP]
> Si le servo a des comportements erratiques (jitter), vérifiez que :
> - L'alimentation externe est stable (condensateur 100µF recommandé)
> - Les masses (GND) sont bien reliées
> - Le câble signal n'est pas trop long

## Architecture Code

```
src/Framework/Servo/
├── Servo.py          # Classe principale
└── ServoDelegate.py  # Interface de callback
```

### Classe Servo

```python
from src.Framework.Servo.Servo import Servo
from src.Framework.Servo.ServoDelegate import ServoDelegate

# Initialisation sur le GPIO 32
my_servo = Servo(pin_id=32, delegate=ServoDelegate(), name="DreamServo")

# Positionner à 180 degrés (ouvrir le piège)
my_servo.set_angle(180)

# Revenir à 0 degrés (fermer le piège)
my_servo.set_angle(0)

# Couper le signal (relâche le moteur)
my_servo.off()
```

### Paramètres du Constructeur

| Paramètre | Type | Défaut | Description |
| :--- | :--- | :--- | :--- |
| `pin_id` | int | *requis* | GPIO PWM-capable |
| `delegate` | ServoDelegate | *requis* | Callback pour événements |
| `name` | str | `"Servo"` | Nom pour logs |
| `freq` | int | `50` | Fréquence PWM (Hz) |
| `min_duty` | int | `26` | Duty cycle pour 0° (10-bit) |
| `max_duty` | int | `123` | Duty cycle pour 180° (10-bit) |

```

## Schéma de Câblage

```
                    ┌──────────────┐
                    │    ESP32     │
                    │              │
     ┌──────────────┤ GPIO 32      │
     │              │              │
     │              │ GND ─────────┼──────┐
     │              └──────────────┘      │
     │                                    │
     │  Signal                            │
     │  (Orange)     ┌─────────────┐      │
     └──────────────►│   SG90      │      │
                     │             │      │
     5V ────────────►│ Rouge (VCC) │      │
     (Alim Externe)  │             │      │
                     │ Marron (GND)├──────┘
                     └─────────────┘
```

> [!IMPORTANT]
> Toujours connecter le GND de l'alimentation externe au GND de l'ESP32 pour avoir une référence commune.

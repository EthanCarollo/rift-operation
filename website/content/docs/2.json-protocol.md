---
title: "Le JSON"
description: "Standardisation du protocole de communication."
category: "Technique"
tags: ["Protocol", "JSON", "Communication"]
---

# Le JSON

Comment est ce qu'on compte s'y prendre pour faire un magnifique JSON ?

En gros on a tout un systeme, trop gros.

<MermaidDiagram
 code= "  flowchart LR
  %% --- Rift Operation ----------------------------------------------------------
  subgraph ro[Rift Operation]
      server[Transit Server]
      llm_server[LLM Server]
      subgraph stranger[Stranger]
          esp32_1[ESP32 Parent]
          rfid_for_scrabble[RFID SCRABBLE]
          esp32_2[ESP32 Enfant]
          raspberry[Raspberry Parent]
          projecteur[Projecteur]
          subgraph pinguin[Pinguin]
              micro_pinguin[Microphone]
              haut_parleur[Haut parleur]
          end
      end
      subgraph imagination[Imagination]
          subgraph animals[Animals]
              esp32_4[ESP32 Enfant]
              camera_animals[Camera]
              haut_parleur_animals[Haut parleur]
          end
          cervomoteur[Cervomoteur]
          imaginationRfid[Capteur RFID]
          rpiParent[Raspberry Parent]
          projecteur2[Projecteur Parent]
          enceinte[Enceinte]
          lightsensor[Light sensor]
          cervomoteur2[Cervomoteur]
          ledPa[Led]
      end
      subgraph depth[Depth]
          esp32_depth_1[ESP32 Enfant]
          esp32_depth_2[ESP32 Parent]
          button_depth_1[Bouton x4]
          haut_parleur_depth[Haut Parleur Enfant]
          cervo_moteur_faille[Cervo moteur pour faille]
          button_depth_2[Bouton x4]
          led_depth[Led x4]
          cervo_moteur_faille_2[Cervo moteur pour faille]
      end
      subgraph rift_table[Rift Table]
          esp32_table_1[ESP32 Table Enfant]
          esp32_table_2[ESP32 Table Parent]
          capt_rfid_1[Capteur RFID x3]
          capt_rfid_2[Capteur RFID x3]
      end
      subgraph wall[Wall]
          raspberry_wall[Raspberry]
          leds[Leds]
          haut_parleur_wall[Haut parleur]
      end
      subgraph Ending
          pc[Computer mac or whatever]
          camera_1[Camera]
          camera_2[Camera]
          led_ending[Led]
          button_ending_1[Button]
          button_ending_2[Button]
      end
  end
  %% ======================= CONNECTIONS =====================================
  %% Rift Operation main links
  esp32_1 --> server
  llm_server --> server
  rfid_for_scrabble --> esp32_1
  esp32_2 --> server
  micro_pinguin --> esp32_2
  haut_parleur --> esp32_2
  raspberry --> server
  raspberry --> projecteur
  %% Imagination links
  esp32_4 --> camera_animals
  esp32_4 --> haut_parleur_animals
  esp32_4 --> server
  esp32_4 --> cervomoteur
  esp32_4 --> imaginationRfid
  rpiParent --> ledPa
  rpiParent --> cervomoteur2
  rpiParent --> lightsensor
  rpiParent --> enceinte
  rpiParent --> projecteur2
  rpiParent --> server
  esp32_depth_1 --> button_depth_1
  esp32_depth_1 --> haut_parleur_depth
  esp32_depth_1 --> cervo_moteur_faille
  esp32_depth_2 --> button_depth_2
  esp32_depth_2 --> led_depth
  esp32_depth_2 --> cervo_moteur_faille_2
  esp32_depth_1 --> server
  esp32_depth_2 --> server
  esp32_table_1 --> capt_rfid_1
  esp32_table_2 --> capt_rfid_2
  esp32_table_1 --> server
  esp32_table_2 --> server
  raspberry_wall --> leds
  raspberry_wall --> haut_parleur_wall
  raspberry_wall --> server
  camera_1 --> pc
  camera_2 --> pc
  led_ending --> pc
  button_ending_1 --> pc
  button_ending_2 --> pc
  pc --> server
 ">
</MermaidDiagram>

> Et nous on va faire un json a partir de ca pour savoir ce qui passe par le serveur de transaction (transac serveur lol)

# Notre cher JSON

Bonjour, voici le json tel que nous le pensons ahah ! Il va être constitué de plusieurs partounes !

## Rift table

```json
"device_id": string (mandatory)
"rift_part_count": int | null

"operator_launch_close_rift_step_1": bool | null
"operator_launch_close_rift_step_2": bool | null
"operator_launch_close_rift_step_3": bool | null
```

## Step 1 - Stranger

> `operator_start_system` permet de lancer l'intégralité du system

```json
"operator_start_system": bool | null,
"stranger_state": string | null,
"stranger_recognized_name": bool | null,
"is_dark_cosmo_here": bool | null,
"pinguin_micro": base64 (chunk of 2500ms) | null
"pinguin_audio": base64 (full audio) | null
```

> `stranger_recognized_name` va simplement faire activer les servo moteurs et modifier ce qui est affiché avec le projecteur. C'est le signal de fin.

## Step 2 - Depth

> Se lance quand `rift_part_count` == 2 (A vérifier avec le scénario)

```json
"depth_state": string | null,
"depth_step_1_nightmare_sucess": bool | null,
"depth_step_2_nightmare_sucess": bool | null,
"depth_step_3_nightmare_sucess": bool | null,
"depth_step_1_dream_sucess": bool | null,
"depth_step_2_dream_sucess": bool | null,
"depth_step_3_dream_sucess": bool | null
```

## Step 3 - Imagination

> Se lance quand `rift_part_count` == 4 (A vérifier avec le scénario)

```json
"lost_state": string | null,
"lost_drawing_light_recognized": bool | null,
"lost_cage_is_on_monster": bool | null,
"lost_light_is_triggered": bool | null,
"lost_mp3_play": string | null,
"lost_video_play": string | null
```

## Step 4 - Battle

> Se lance quand `rift_part_count` == 4 (après Imagination)
> Combat final contre l'Étranger

```json
"battle_state": string | null,                    // idle, appearing, fighting, hit, weakened, captured, done
"battle_drawing_dream_recognised": bool | null,   // Dessin reconnu par cam Dream
"battle_drawing_nightmare_recognised": bool | null, // Dessin reconnu par cam Nightmare
"battle_hit_confirmed": bool | null,              // Hit confirmé
"battle_cage_nightmare": bool | null,             // Cage RFID détectée (Nightmare)
"battle_cage_dream": bool | null,                 // Cage RFID détectée (Dream)
"battle_video_play": string | null,               // Vidéo à jouer
"battle_music_play": string | null,               // Musique à jouer
"battle_boss_hp": number | null,                  // Points de vie du boss (1-5)
"battle_boss_attack": string | null               // Nom de l'attaque du boss
```

## Step 5 - Ending

> Se lance quand `rift_part_count` == 6 (A vérifier avec le scénario)

```json
"end_system": string | null,
"reset_system": bool | null
```

# Le JSON Complet

```json
{
    // Identification
    "device_id": string,

    // Rift table
    "rift_part_count": int | null,
    "operator_launch_close_rift_step_1": bool | null,
    "operator_launch_close_rift_step_2": bool | null,
    "operator_launch_close_rift_step_3": bool | null,

    // Step 1 - Stranger
    "operator_start_system": bool | null,
    "stranger_state": string | null,
    "stranger_recognized_name": bool | null,
    "is_dark_cosmo_here": bool | null,
    "pinguin_micro": base64 (chunk of 2500ms) | null,
    "pinguin_audio": base64 (full audio) | null,

    // Step 2 - Depth
    "depth_state": string | null,
    "depth_step_1_nightmare_sucess": bool | null,
    "depth_step_2_nightmare_sucess": bool | null,
    "depth_step_3_nightmare_sucess": bool | null,
    "depth_step_1_dream_sucess": bool | null,
    "depth_step_2_dream_sucess": bool | null,
    "depth_step_3_dream_sucess": bool | null,

    // Step 3 - Imagination
    "lost_state": string | null,
    "lost_drawing_light_recognized": bool | null,
    "lost_cage_is_on_monster": bool | null,
    "lost_light_is_triggered": bool | null,
    "lost_mp3_play": string | null,
    "lost_video_play": string | null,

    // Step 4 - Battle
    "battle_state": string | null,
    "battle_drawing_dream_recognised": bool | null,
    "battle_drawing_nightmare_recognised": bool | null,
    "battle_hit_confirmed": bool | null,
    "battle_cage_nightmare": bool | null,
    "battle_cage_dream": bool | null,
    "battle_video_play": string | null,
    "battle_music_play": string | null,
    "battle_boss_hp": number | null,
    "battle_boss_attack": string | null,

    // Step 5 - Ending
    "end_system": string | null,
    "reset_system": bool | null
}
```